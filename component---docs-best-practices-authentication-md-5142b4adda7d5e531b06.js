(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{BtpT:function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return l})),n.d(t,"default",(function(){return r}));n("5hJT"),n("W1QL"),n("K/PF"),n("t91x"),n("75LO"),n("PJhk");var a=n("SAVP"),o=n("TjRS");n("aD51");function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var l={};void 0!==l&&l&&l===Object(l)&&Object.isExtensible(l)&&!l.hasOwnProperty("__filemeta")&&Object.defineProperty(l,"__filemeta",{configurable:!0,value:{name:"_frontmatter",filename:"docs/best-practices/authentication.md"}});var s={_frontmatter:l},u=o.a;function r(e){var t=e.components,n=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,["components"]);return Object(a.b)(u,i({},s,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h1",{id:"authentication"},"Authentication"),Object(a.b)("p",null,"Most of the projects requiring any sort of user authentication should use Tunnistamo.\nTunnistamo is a service that authenticates users against several different identity sources,\nincluding Espoo, Vantaa and Helsinki internal accounts, Facebook, Google and Github.\nTunnistamo also keeps a running session for the user, meaning the user won't be needing\nto login again to access another service using tunnistamo."),Object(a.b)("p",null,"The actual line protocols are OAuth2 and OIDC. New applications should always use OIDC."),Object(a.b)("p",null,Object(a.b)("em",{parentName:"p"},"Nomenclature alert"),': Tunnistamo will soon be changing names, as the implementation will switch from your own implementation (named "tunnistamo") to Keycloak based implementation. Keeping the same name would be too confusing. We\'re not sure of the upcoming name yet.'),Object(a.b)("h2",{id:"getting-necessary-tunnistamo-identifiers"},"Getting necessary Tunnistamo identifiers"),Object(a.b)("p",null,"To get started you will either need a locally setup instance of Tunnistamo or get access to one of shared instances available within Helsinki infrastructure. It is recommended that you try and get access to the shared instances, unless you must develop offline. "),Object(a.b)("p",null,"Current instances are:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"Kanslia (executive office) instance: default instance used by projects, both during development and production"),Object(a.b)("li",{parentName:"ul"},"KuVa (culture and leisure) instance: instance used by KuVa projects during their development. Very flexible registration")),Object(a.b)("p",null,"To get access to Kanslia instance, pop by the slack channel #tunnistamo.\nFor KuVa instance the onboarding process has already told you the right channels."),Object(a.b)("p",null,"As a concrete result you will have four pieces of data:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"the URL for your tunnistamo instance (like ",Object(a.b)("a",i({parentName:"li"},{href:"https://api.hel.fi/sso/"}),"https://api.hel.fi/sso/"),", the executive office instance)"),Object(a.b)("li",{parentName:"ul"},"your client ID"),Object(a.b)("li",{parentName:"ul"},"your client secret (this does not exist in all cases)"),Object(a.b)("li",{parentName:"ul"},"your agreed callback URL. This depends entirely on your authentication library")),Object(a.b)("p",null,"Callback URL is the address within your application for finalizing the authentication. You will have at least two callbacks:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},'one within "localhost", for using on your own personal computer'),Object(a.b)("li",{parentName:"ul"},"one or more, that refer to public instances of your application")),Object(a.b)("p",null,"Armed with those you can begin attaching authentication to your application."),Object(a.b)("h2",{id:"handling-authentication-user-login"},"Handling authentication (user login)"),Object(a.b)("p",null,"Actual usage is abstracted behind libraries:"),Object(a.b)("p",null,"Django based backends: ",Object(a.b)("a",i({parentName:"p"},{href:"https://github.com/City-of-Helsinki/django-helusers"}),"django-helusers")),Object(a.b)("p",null,"JS based frontends: no specific library at the moment, would be beneficial"),Object(a.b)("p",null,"For django-helusers, the README should get you up and running. For JS frontends you will currently have to ask around, Google and look into other JS projects within github.com/City-of-Helsinki"),Object(a.b)("h2",{id:"logout"},"Logout"),Object(a.b)("p",null,"Logout on SSO systems is always kind of tricky. Do you want to only close the session in\nyour application and purge any ephemeral state? In that case user will be automatically\nlogged back in through their tunnistamo session, should they press login again."),Object(a.b)("p",null,"The more thorough logout is to call tunnistamo logout. This has been woefully\nundocumented. Currently suggested procedure is:"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},"Destroy any local state (tokens usw.)"),Object(a.b)("li",{parentName:"ol"},"Open a popup to the OIDC end_session_endpoint available through OIDC discovery document\n(",Object(a.b)("a",i({parentName:"li"},{href:"https://api.hel.fi/sso/.well-known/openid-configuration"}),"https://api.hel.fi/sso/.well-known/openid-configuration")," ). You can use this regardless\nof whether your application uses OAuth2 or OIDC."),Object(a.b)("li",{parentName:"ol"},"SSO will include a code in the popup that will close it automatically")),Object(a.b)("p",null,"The authentication libraries you use might handle all these steps automatically."),Object(a.b)("p",null,"The logout popup will inform the user that they will need to log out of any upstream IdPs\n(like YLE or Facebook), if they wish to."),Object(a.b)("p",null,"SPA can additionally listen for postMessage hel:logout. This is supposed to indicate that\nthe logout actually succeeded. (This is not actually implemented at the moment)."))}r&&r===Object(r)&&Object.isExtensible(r)&&!r.hasOwnProperty("__filemeta")&&Object.defineProperty(r,"__filemeta",{configurable:!0,value:{name:"MDXContent",filename:"docs/best-practices/authentication.md"}}),r.isMDXComponent=!0}}]);
//# sourceMappingURL=component---docs-best-practices-authentication-md-5142b4adda7d5e531b06.js.map